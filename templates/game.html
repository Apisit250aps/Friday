{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Friday</title>
    <link rel="shortcut icon" href="{% static 'img/FRIDAY.png' %}" type="image/x-icon">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <style>
        #info {
            height: 100%;
            background-color: var(--light);
            overflow-y: hidden;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 1rem 1rem 1rem 1rem;

        }

        #boss {
            width: 100%;
            border-radius: 10px;

        }

        #danger {
            width: 100%;
            height: 15vh;

            border-radius: 10px;
        }

        #log {
            background-color: var(--light);
            padding: 1rem;
        }

        #game {
            height: 100vh;
        }

        body {
            overflow: hidden;
        }

        /* Hide scrollbar for Chrome, Safari and Opera */
        *::-webkit-scrollbar {
            display: none;
        }

        /* Hide scrollbar for IE, Edge and Firefox */
        * {
            -ms-overflow-style: none;
            /* IE and Edge */
            scrollbar-width: none;
            /* Firefox */
        }
    </style>
</head>

<body>
    <main id="game" class="row m-auto">
        <div class="col-3" id="info" v-if="game_data!=null">
            <div id="boss" class="p-2 bg-danger">
                <table class="table" v-if="game_data!=null">
                    <thead>
                        <th>name</th>
                        <th>pick</th>
                        <th>LP</th>
                        <th>SKILL</th>
                    </thead>
                    <tbody>
                        <tr v-for="(item, index) in game_data.boss" :key="index">
                            <td>[{item.card.name}]</td>
                            <td>[{item.card.pick}]</td>
                            <td>[{item.card.life_point}]</td>
                            <td>[{item.card.active}]</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <button type="button" class="btn "
                :class="{ 'btn-success':(game_data.game.level == 1),'btn-warning':(game_data.game.level == 2),'btn-danger':(game_data.game.level == 3), 'disabled':finder==false }"
                @click="randomDanger()">
                DANGER RANDOM <span v-if="dangers!=null">[{dangers.length }]</span>
            </button>
        </div>
        <div class="col-6 d-flex flex-column text-white" id="log">
            <!--  -->

            <!-- Button trigger modal -->
            <button type="button" id="danger-modal-open" class="btn btn-primary" data-bs-toggle="modal"
                data-bs-target="#exampleModal" hidden>
                Launch demo modal
            </button>

            <!-- Modal -->
            <div class="modal fade modal-lg" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel"
                v-if="dangers!=null" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
                            <button type="button" class="btn-close" id="danger-modal-close" data-bs-dismiss="modal"
                                aria-label="Close"></button>
                        </div>
                        <div class="modal-body row row-cols-3 m-auto gx-3">
                            <div class="card col" v-for="(item, index) in dangers" :key="index">
                                <img src="https://via.placeholder.com/1024x768/eee?text=4:3" class="card-img-top"
                                    alt="...">
                                <div class="card-body">
                                    <h5 class="card-title">[{item.danger.name}]</h5>
                                    <p class="card-text">[{item.danger.life_point}]</p>
                                    <p class="card-text">[{item.danger.pick}]</p>
                                    <button type="button" @click="selectCard(index)" href="#" class="btn btn-primary">Go
                                        somewhere</button>
                                </div>
                            </div>
                        </div>
                        <!-- <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            <button type="button" class="btn btn-primary">Save changes</button>
                        </div> -->
                    </div>
                </div>
            </div>
            <!--  -->
            <div id="danger" class="row row-cols-2 mx-auto rounded-4">
                <div class="col bg-danger">
                    <h1>Danger</h1>
                    <table class="table" v-if="game_data!=null">
                        <tr>
                            <th>Name</th>
                            <td>[{ quest.danger.name }]</td>
                        </tr>
                        <tr>
                            <th>LP</th>
                            <td>[{ quest.danger.life_point }]</td>
                        </tr>
                        <tr>
                            <th>Pick</th>
                            <td>[{ quest.danger.pick }]</td>
                        </tr>

                    </table>
                </div>
                <div class="col bg-success">
                    <h1>Skill</h1>
                    <table class="table" v-if="game_data!=null">
                        <tr>
                            <th>Name</th>
                            <td>[{ quest.skill.name }]</td>
                        </tr>
                        <tr>
                            <th>Power</th>
                            <td>[{ quest.skill.power }]</td>
                        </tr>
                        <tr>
                            <th>Spend</th>
                            <td>[{ quest.skill.spend }]</td>
                        </tr>

                    </table>

                </div>

            </div>
            <hr>
            <div class="p-2 mt-5">
                <table class="table" >
                    <thead>
                        <th>name</th>
                        <th>power</th>
                        <th>active</th>
                        <th>spend</th>
                        
                    </thead>
                    <tbody>
                        <tr v-for="(item, index) in fields" :key="index">
                            <td>[{item.name}]</td>
                            <td>[{item.power}]</td>
                            <td>[{item.active}]</td>
                            <td>[{item.spend}]</td>
                           
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div class="col-3 p-3 d-flex flex-column justify-content-between" id="state">
            <table class="table" v-if="game_data!=null">
                <tr>
                    <th>LP</th>
                    <td>[{ game_data.game.life_point }]</td>
                </tr>
                <tr>
                    <th>Year</th>
                    <td>[{ game_data.game.age }]</td>
                </tr>
                <tr>
                    <th>Level</th>
                    <td>[{ game_data.game.level }]</td>
                </tr>
                <tr>
                    <th>Rounds</th>
                    <td>[{ game_data.game.round }]</td>
                </tr>
                <tr>
                    <th>Deck</th>
                    <td>[{ game_data.deck }]</td>
                </tr>
            </table>
            <button type="button" class="btn btn-outline-dark w-100" @click="draw()">Draw <span>[{pick_value
                    }]</span></button>
        </div>
    </main>
    <script>
        const { createApp, ref } = Vue;
        const app = createApp(
            {
                delimiters: ["[{", "}]"],
                data() {
                    return {
                        game: "{{id}}",
                        game_data: null,
                        quest: {
                            danger: {
                                id: null,
                                name: null,
                                pick: null,
                                life_point: null
                            },
                            skill: {
                                id: null,
                                name: null,
                                power: null,
                                active: null,
                                spend: null,
                                type: null
                            }
                        },
                        dangers: null,
                        finder: true,
                        pick_value: 0,
                        fields: []
                    };
                },
                mounted() {
                    console.log("hello");
                    const form_data = new FormData;
                    form_data.append('csrfmiddlewaretoken', '{{ csrf_token }}');
                    form_data.append('id', '{{id}}');
                    axios(
                        {
                            method: "post",
                            url: "{% url 'game-data-api' %}",
                            data: form_data
                        }
                    ).then((response) => {
                        if (response.data['status']) {
                            this.game_data = response.data['data'];
                        }
                        else {

                        }
                        console.log(response.data);
                    });
                },
                methods: {
                    draw() {
                        if (this.pick_value >= 1) {
                            const form_data = new FormData;
                            form_data.append('csrfmiddlewaretoken', '{{ csrf_token }}');
                            form_data.append('id', '{{id}}');
                            axios(
                                {
                                    method: 'post',
                                    url: "{% url 'draw-api' %}",
                                    data: form_data
                                }
                            ).then((response) => {
                                this.fields.push(response.data['card']);
                                this.game_data.deck = response.data['deck']
                            });
                            this.pick_value -= 1
                        }
                        else {

                        }
                    },
                    selectCard(id) {
                        this.quest = this.dangers[id];
                        setTimeout(() => {
                            this.dangers = null;
                            this.finder = false;
                            this.pick_value = this.quest.danger.pick;
                        }, 100);
                        document.getElementById("danger-modal-close").click();
                    },
                    randomDanger() {
                        if (this.dangers == null) {
                            axios(
                                {
                                    method: "get",
                                    url: "{% url 'danger-api' %}"
                                }
                            ).then((response) => {
                                this.dangers = response.data['data'];
                                setTimeout(() => {
                                    document.getElementById("danger-modal-open").click();
                                }, 100);
                            });
                        }
                        setTimeout(() => {
                            document.getElementById("danger-modal-open").click();
                        }, 100);
                    }
                }
            }
        );
        app.mount('#game')
    </script>
    <!--  -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
        integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"
        integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+"
        crossorigin="anonymous"></script>
</body>

</html>